#!/bin/bash

ps -ef | grep pmon | grep -v grep | grep -v perl | grep -v ASM | grep -v DBFS | grep -v dbm | sort |\
while read PMON; do
   INST=`echo "$PMON" | awk {' print $8 '} | cut -f3 -d_`

  MAIN_ENV=~/.env/main.env
  if [ -r $MAIN_ENV ]; then
     . $MAIN_ENV $INST
  else
     echo 'Could not open $MAIN_ENV for read.'
  fi

  sqlplus -s /nolog <<-EOF
  connect / as sysdba
  set head off
  set tab off
  set trimspool on

  set pages 0
  set echo off
  set feedback off
  set lines 155
  col name for a20
  col value for a20

  select '$INST' from dual;
  select '------------------' from dual;
  select status from v\$instance;

EOF
echo 
done


