#!/bin/bash

export SID=$1
export user=$2
export passwd=$3
export sessions=$4

create_tables() {
  sqlplus -s /nolog<<EOF
  connect ${user}/${passwd}@${SID}
  drop table mytab5;
  create table mytab5 nologging as select * from dba_objects;
  insert /*+ APPEND */ into mytab5 (select * from mytab5);
  commit;
  insert /*+ APPEND */ into mytab5 (select * from mytab5);
  commit;
  insert /*+ APPEND */ into mytab5 (select * from mytab5);
  commit;
  insert /*+ APPEND */ into mytab5 (select * from mytab5);
  commit;
  insert /*+ APPEND */ into mytab5 (select * from mytab5);
  commit;
  insert /*+ APPEND */ into mytab5 (select * from mytab5);
  commit;
  insert /*+ APPEND */ into mytab5 (select * from mytab5);
  commit;
  insert /*+ APPEND */ into mytab5 (select * from mytab5);
  commit;
  insert /*+ APPEND */ into mytab5 (select * from mytab5);
  commit;
  insert /*+ APPEND */ into mytab5 (select * from mytab5);
  commit;
  insert /*+ APPEND */ into mytab5 (select * from mytab5);
  commit;
  insert /*+ APPEND */ into mytab5 (select * from mytab5);
  commit;

  drop table mytab6;
  create table mytab6 nologging as select * from mytab5;
  EXIT
EOF
}

burn_io2() {
  sqlplus -s /nolog<<EOF
  connect ${user}/${passwd}@${SID}

  select *
    from mytab5 a, 
         mytab6 b
   where a.object_id    = b.object_id
     and a.owner        = b.owner
     and a.object_type  = b.object_type
     and a.object_name  = b.object_name;

  EXIT
EOF
}

JOBS=0
#create_tables
while :; do
   burn_io2 > /dev/null &
   #burn_io2  &
   JOBS=`jobs | wc -l`
   while [ "$JOBS" -ge "$sessions" ]; do
      sleep 5
      JOBS=`jobs | wc -l`
   done
done

